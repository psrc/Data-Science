SELECT * FROM Angela.STEP3_17_16

SELECT PROJYEAR, DELETE_, SUM(UNITS)
FROM Angela.STEP4_17_16
GROUP BY PROJYEAR,  DELETE_


-- CREATE A TABLE ONLY HAS NON-DELETED PERMIT 
SELECT * INTO Angela.STEP4_17_16 
FROM ANGELA.STEP3_17_16
WHERE DELETE_ is null OR DELETE_ = 0


-- update issue year
UPDATE Angela.STEP4_17_16
SET ISSUEDYEAR = YEAR(ISSUED)
FROM Angela.STEP4_17_16


-- VALIDATE
SELECT ISSUEDYEAR, COUNT(*)
FROM Angela.STEP4_17_16
GROUP BY ISSUEDYEAR



-- update null value county
UPDATE Angela.STEP4_17_16
SET CNTY = 33
FROM Angela.STEP4_17_16
WHERE JURIS17 = 'LAKEFORESTPARK'

UPDATE Angela.STEP4_17_16
SET CNTY = 33
FROM Angela.STEP4_17_16
WHERE JURIS17 = 'CLYDEHILL'

UPDATE Angela.STEP4_17_16
SET CNTY = 33
FROM Angela.STEP4_17_16
WHERE JURIS17 = 'MERCERISLAND'

UPDATE Angela.STEP4_17_16
SET CNTY = 61
FROM Angela.STEP4_17_16
WHERE JURIS17 = 'MILLCREEK'

-- validate
SELECT * FROM Angela.STEP4_17_16
WHERE CNTY is null

-- update CNTY
UPDATE Angela.STEP4_17_16
SET CNTY = 035
FROM Angela.STEP4_17_16
WHERE CNTY = 35

UPDATE Angela.STEP4_17_16
SET CNTY = 061
FROM Angela.STEP4_17_16
WHERE CNTY = 61

UPDATE Angela.STEP4_17_16
SET CNTY = 033
FROM Angela.STEP4_17_16
WHERE CNTY = 33

UPDATE Angela.STEP4_17_16
SET CNTY = 053
FROM Angela.STEP4_17_16
WHERE CNTY = 53



-- update TYPE4

UPDATE Angela.STEP4_17_16
SET TYPE4 = 
CASE 
        WHEN PROJYEAR = 2017 AND TYPE = 111 THEN 'SF'
        WHEN PROJYEAR = 2017 AND TYPE = '111' THEN 'SF'
        WHEN PROJYEAR = 2017 AND TYPE = 121 THEN 'MF1-2'
        WHEN PROJYEAR = 2017 AND TYPE >= 122 AND TYPE <= 123 THEN 'MF3-4'
        WHEN PROJYEAR = 2017 AND TYPE = 131 THEN 'MF5-9'
        WHEN PROJYEAR = 2017 AND TYPE >= 132 AND TYPE <= 133 THEN 'MF10-19'
        WHEN PROJYEAR = 2017 AND TYPE >= 141 AND TYPE <= 143 THEN 'MF20-49'
        WHEN PROJYEAR = 2017 AND TYPE = 144 THEN 'MF50+'
        WHEN PROJYEAR = 2017 AND TYPE >= 151 AND TYPE <= 159 THEN 'GQ'
        WHEN PROJYEAR = 2017 AND TYPE = 170 THEN 'MH'
        WHEN PROJYEAR = 2017 AND TYPE >= 181 AND TYPE <= 189 THEN 'TL'
        WHEN PROJYEAR = 2017 AND TYPE = 191 THEN 'MH'
        WHEN PROJYEAR = 2017 AND TYPE = 192 THEN 'OTH'
        WHEN PROJYEAR = 2017 AND TYPE = 194 THEN 'MH'
        WHEN PROJYEAR = 2017 AND TYPE = 199 THEN 'OTH'
        ELSE '999'
END



SELECT TYPE, TYPE4, COUNT(UNITS)
FROM Angela.STEP4_17_16
WHERE ISSUEDYEAR = 2017
GROUP BY TYPE, TYPE4



SELECT TYPE, TYPE2, TYPE3, TYPE4, UNITS
FROM Angela.STEP4_17_16
WHERE TYPE4 = 999 AND ISSUEDYEAR = 2017












select * from information_schema.columns









